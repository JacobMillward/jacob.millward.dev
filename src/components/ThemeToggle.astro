---
---
<label class="theme-toggle" for="themeToggle">
    <input type="checkbox" id="themeToggle" />
    <svg width="30" height="30" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path class="sun" fill-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1l-1.8 1.8a.8.8 0 0 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM6.3 17.7a.8.8 0 0 1 0 1l-1.7 1.8a.8.8 0 1 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1 0l1.8 1.8a.8.8 0 1 1-1 1L3.5 4.6a.8.8 0 0 1 0-1zm14.2 14.2a.8.8 0 0 1 1 0l1.8 1.7a.8.8 0 0 1-1 1l-1.8-1.7a.8.8 0 0 1 0-1z"/>
        <path class="moon" fill-rule="evenodd" d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z"/>
    </svg>
</label>

<noscript>
    <style>
        .theme-toggle { display: none; }
    </style>
</noscript>

<style>
    .theme-toggle {
        --icon-fill: var(--secondary-color);
        --icon-fill-hover: var(--font-color);
        cursor: pointer;
    }
    .theme-toggle input { display: none; }
    .theme-toggle svg {
        width: 30px;
        height: 30px;
        padding: 5px;
        border-radius: 50%;
        transition: background-color 0.3s ease-in-out;
    }
    .theme-toggle path {
        fill: var(--icon-fill);
        transition: fill 0.3s ease-in-out;
    }
    .theme-toggle:hover path { fill: var(--icon-fill-hover); }

    .theme-toggle .sun { display: none; }
    .theme-toggle input:checked ~ svg .sun { display: block; }
    .theme-toggle input:checked ~ svg .moon { display: none; }
    .theme-toggle input:not(:checked) ~ svg .moon { display: block; }
    .theme-toggle input:not(:checked) ~ svg .sun { display: none; }

    /* Theme Variables */
    :root {
        --global-font-size: 15px;
        --global-line-height: 1.4em;
        --global-space: 10px;
        --font-stack: Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace, serif;
        --mono-font-stack: Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace, serif;
        --primary-color: #62c4ff;
        --error-color: #ff3c74;
        --input-style: solid;
        --display-h1-decoration: none;
    }

    :root {
        --background-color: #222225;
        --font-color: #e8e9ed;
        --invert-font-color: #222225;
        --secondary-color: #a3abba;
        --tertiary-color: #a3abba;
        --progress-bar-background: #3f3f44;
        --progress-bar-fill: #62c4ff;
        --code-bg-color: #3f3f44;
    }

    :root.light {
        --background-color: #ffffff;
        --font-color: #000000;
        --invert-font-color: #ffffff;
        --progress-bar-background: #e0e0e0;
        --code-bg-color: #f5f5f5;
    }

    :root.dark {
        --background-color: #222225;
        --font-color: #e8e9ed;
        --invert-font-color: #222225;
        --secondary-color: #a3abba;
        --tertiary-color: #a3abba;
        --progress-bar-background: #3f3f44;
        --progress-bar-fill: #62c4ff;
        --code-bg-color: #3f3f44;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --background-color: #222225;
            --font-color: #e8e9ed;
            --invert-font-color: #222225;
            --secondary-color: #a3abba;
            --tertiary-color: #a3abba;
            --progress-bar-background: #3f3f44;
            --progress-bar-fill: #62c4ff;
            --code-bg-color: #3f3f44;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --background-color: #ffffff;
            --font-color: #000000;
            --invert-font-color: #ffffff;
            --progress-bar-background: #e0e0e0;
            --code-bg-color: #f5f5f5;
        }
    }
</style>

<script>
    enum Theme {
        Light = 'light',
        Dark = 'dark',
    }

    const themeToggle = document.getElementById('themeToggle') as HTMLInputElement;
    const rootElement = document.documentElement;

    function getStoredTheme() {
        const stored = localStorage.getItem('theme');
        if (stored === Theme.Light || stored === Theme.Dark) {
            return stored;
        }
        return undefined;
    }

    function applyTheme(theme: Theme) {
        const inverseTheme = theme === Theme.Light ? Theme.Dark : Theme.Light;
        rootElement.classList.remove(inverseTheme);
        rootElement.classList.add(theme);
    }

    function getPreferredTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? Theme.Dark : Theme.Light;
    }

    document.addEventListener('DOMContentLoaded', () => {
        const storedTheme = getStoredTheme();
        const theme = storedTheme ?? getPreferredTheme();
        applyTheme(theme);
        themeToggle.checked = theme === Theme.Light;
    });

    themeToggle.addEventListener('change', () => {
        const theme = themeToggle.checked ? Theme.Light : Theme.Dark;
        applyTheme(theme);
        localStorage.setItem('theme', theme);
    });

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!getStoredTheme()) {
            const theme = e.matches ? Theme.Dark : Theme.Light;
            applyTheme(theme);
            themeToggle.checked = theme === 'light';
        }
    });
</script>